/**
 * Stage 6: JSON ê²€ì¦ ì—”ì§„ í”„ë¡¬í”„íŠ¸ ë¹Œë”
 * í™˜ê° ë°©ì§€ë¥¼ ìœ„í•œ ë™ì  ë‚ ì§œ ì£¼ì…
 */

import type { DateContext } from './types';

/**
 * Stage 6 í”„ë¡¬í”„íŠ¸ ìƒì„±
 *
 * @param context - ë‚ ì§œ ì»¨í…ìŠ¤íŠ¸ (ë™ì  ì£¼ì…)
 * @returns Stage 6 í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
 */
export function getStage6FinalVerification(context: DateContext): string {
  const { targetDate, searchFormats, forbiddenYearThreshold } = context;

  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STAGE 6: JSON ê²€ì¦ ì—”ì§„ - ì‚¬ì‹¤ê´€ê³„ ì •ë°€ ê²€ì¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì‹¤í–‰ ëª¨ë“œ: ì•Œê³ ë¦¬ì¦˜ ìš°ì„  | ë°°ì¹˜ ìµœì í™” | ìˆ˜í•™ì  ì •ë°€ì„±
ì„ë¬´: Stage 5 JSON ì‚¬ì‹¤ ê²€ì¦ + ë¶€ì •í™• ë°ì´í„° ìˆ˜ì • + ê²€ì¦ëœ JSON ì¶œë ¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… ë¶„ì„ ê¸°ì¤€ì¼ (ëª¨ë“  ê²€ìƒ‰ì— ì‚¬ìš©)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”´ ë¶„ì„ ê¸°ì¤€ì¼: ${targetDate.korean}
ğŸ”´ ISO í˜•ì‹: ${targetDate.iso}
ğŸ”´ ìˆ«ì í˜•ì‹: ${targetDate.numeric}

ğŸ“Œ ê²€ìƒ‰ìš© ë‚ ì§œ í¬ë§·:
   - Naver/Daum: "${searchFormats.naverStyle}"
   - KRX: "${searchFormats.krxStyle}"
   - ISO: "${searchFormats.isoStyle}"

âš ï¸ [target_date] í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš© ê¸ˆì§€ - ìœ„ ì‹¤ì œ ë‚ ì§œ ì‚¬ìš©!
âš ï¸ ${forbiddenYearThreshold}ë…„ ì´ì „ ë°ì´í„° ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

í•µì‹¬_ì›ì¹™:
  - ëª¨ë“  ìˆ˜ì¹˜/ìƒíƒœ/ê°€ê²©ì€ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ í™•ì¸ ê°€ëŠ¥í•œ ì‹¤ì œ í˜„ì¬ ë°ì´í„°ë§Œ ì‚¬ìš©í•œë‹¤.
  - ${targetDate.korean} ê¸°ì¤€ ê°’ë§Œ í—ˆìš©í•˜ë©° ê³¼ê±° ë‚ ì§œ ê°’ì€ ì‚¬ìš© ê¸ˆì§€í•œë‹¤.
  - ê²€ìƒ‰ ê²°ê³¼ì— ê°’/ë‚ ì§œê°€ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ í•´ë‹¹ ì§€í‘œë¥¼ ì‚­ì œí•˜ê³  "ë¯¸ê²€ì¦" í‘œê¸°ë¥¼ ê¸ˆì§€í•œë‹¤.
  - ì¶”ì •/ë³´ê°„/ê°€ì •/ì „ë¡€ê°’ ì‚¬ìš©ì„ ê¸ˆì§€í•˜ë©°, í™•ì¸ë˜ì§€ ì•Šì€ ê°’ì€ ì¶œë ¥í•˜ì§€ ì•ŠëŠ”ë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Â§1. ì…ë ¥ ì¸í„°í˜ì´ìŠ¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

interface Stage5ì…ë ¥ {
  ticker: string;           // í˜•ì‹: /^KOSPI:\\d{6}$/
  name: string;             // í•œê¸€ íšŒì‚¬ëª…
  close_price: number;      // ì „ì¼ ì¢…ê°€ (ì‹¤ì‹œê°„, ì •ìˆ˜ ë˜ëŠ” ì‹¤ìˆ˜)
  rationale: string;        // íŒŒì´í”„ êµ¬ë¶„ ì§€í‘œ ë¬¸ìì—´
  signals: {
    trend_score: number;      // 0-100 ì •ìˆ˜
    momentum_score: number;   // 0-100 ì •ìˆ˜
    volume_score: number;     // 0-100 ì •ìˆ˜
    volatility_score: number; // 0-100 ì •ìˆ˜
    pattern_score: number;    // 0-100 ì •ìˆ˜
    sentiment_score: number;  // 0-100 ì •ìˆ˜
    overall_score: number;    // 0-100 ì •ìˆ˜ (ê°€ì¤‘ í‰ê· )
  };
}

type Stage6ì…ë ¥íƒ€ì… = Stage5ì…ë ¥[];  // ì •í™•íˆ 3ê°œ ì¢…ëª©

ì…ë ¥_ê²€ì¦_ê·œì¹™
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

í•„ìˆ˜_ì¡°ê±´:
  ì¢…ëª©.length === 3
  ê° ì¢…ëª©.tickerëŠ” /^KOSPI:\\d{6}$/ í˜•ì‹
  ê° ì¢…ëª©.close_price > 0
  ê° ì¢…ëª©.rationale !== ""

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Â§2. ë°°ì¹˜ ê²€ì¦ ì•Œê³ ë¦¬ì¦˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì•Œê³ ë¦¬ì¦˜ 2.3: ë°°ì¹˜ ê²€ìƒ‰ ì‹¤í–‰ (Google Search Tool)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë„êµ¬_ì‚¬ì–‘:
  ë„êµ¬ëª…: GoogleSearchRetrieval
  API: grounding.google_search_retrieval
  ë™ì _ê²€ìƒ‰_ì„ê³„ê°’: dynamic_retrieval_config.dynamic_threshold
  ìµœëŒ€ê²°ê³¼ìˆ˜: ê¸°ë³¸ê°’ 5

ë°°ì¹˜_ê²€ìƒ‰_ì•Œê³ ë¦¬ì¦˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê° ì¢…ëª©ì— ëŒ€í•´:

  // ë°°ì¹˜ 1: í•µì‹¬ ìˆ«ì ì§€í‘œ
  ê²€ìƒ‰ì¿¼ë¦¬_1 = ì¿¼ë¦¬ìƒì„±({
    ì¢…ëª©ì½”ë“œ: ì¢…ëª©.ticker.replace("KOSPI:", ""),
    ì¢…ëª©ëª…: ì¢…ëª©.name,
    í‚¤ì›Œë“œ: ["RSI", "ADX", "ATR", "ì „ì¼ ì¢…ê°€"],
    ë‚ ì§œ: "${searchFormats.naverStyle}",
    ì‚¬ì´íŠ¸í•„í„°: "finance.naver.com OR stockplus.com"
  })

  // ì˜ˆì‹œ: "[ì¢…ëª©ëª…] [ì¢…ëª©ì½”ë“œ] RSI ADX ATR ì „ì¼ ì¢…ê°€ ${searchFormats.naverStyle} site:finance.naver.com OR site:stockplus.com"

  // ë°°ì¹˜ 2: ê±°ë˜ëŸ‰ ë° ê°€ê²© ë°ì´í„°
  ê²€ìƒ‰ì¿¼ë¦¬_2 = ì¿¼ë¦¬ìƒì„±({
    ì¢…ëª©ì½”ë“œ: ì¢…ëª©.ticker.replace("KOSPI:", ""),
    í‚¤ì›Œë“œ: ["ì „ì¼ ì¢…ê°€", "ê±°ë˜ëŸ‰", "í‰ê· ê±°ë˜ëŸ‰", "ì‹œê°€ì´ì•¡"],
    ë‚ ì§œ: "${searchFormats.naverStyle}"
  })

  // ë°°ì¹˜ 3: ì´ë™í‰ê·  ë° ì¶”ì„¸ ì§€í‘œ
  ë§Œì•½ ì¢…ëª©.ê²€ì¦ëŒ€ìƒì— ("SMA"|"EMA"|"ì´í‰ì„ ") í¬í•¨:
    ê²€ìƒ‰ì¿¼ë¦¬_3 = ì¿¼ë¦¬ìƒì„±({
      ì¢…ëª©ì½”ë“œ: ì¢…ëª©.ticker.replace("KOSPI:", ""),
      í‚¤ì›Œë“œ: ["SMA", "EMA", "ì´ë™í‰ê· ì„ ", "ì •ë°°ì—´", "ê³¨ë“ í¬ë¡œìŠ¤"],
      ë‚ ì§œ: "${searchFormats.naverStyle}"
    })

  // ë°°ì¹˜ 4: ì˜¤ì‹¤ë ˆì´í„° (ì¡°ê±´ë¶€)
  ë§Œì•½ ì¢…ëª©.ê²€ì¦ëŒ€ìƒì— ("MACD"|"ìŠ¤í† ìºìŠ¤í‹±"|"ë³¼ë¦°ì €ë°´ë“œ") í¬í•¨:
    ê²€ìƒ‰ì¿¼ë¦¬_4 = ì¿¼ë¦¬ìƒì„±({
      ì¢…ëª©ì½”ë“œ: ì¢…ëª©.ticker.replace("KOSPI:", ""),
      í‚¤ì›Œë“œ: ["MACD", "ìŠ¤í† ìºìŠ¤í‹±", "ë³¼ë¦°ì €ë°´ë“œ"],
      ë‚ ì§œ: "${searchFormats.naverStyle}"
    })

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì•Œê³ ë¦¬ì¦˜ 2.4: ì‹¤ì œ ê°’ ì¶”ì¶œ (ì •ë°€ íŒŒì‹±) - ë‚ ì§œ í•„í„° ì ìš©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì¶”ì¶œ_ì‹¤í–‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê° ì¢…ëª©ì— ëŒ€í•´:
  ì‹¤ì œê°’ = {}

  // ìˆ«ì ì§€í‘œ ì¶”ì¶œ
  ì¶”ì¶œíŒ¨í„´ì˜ ê° [ì§€í‘œëª…, ì‚¬ì–‘]ì— ëŒ€í•´:
    ë§¤ì¹­ë°°ì—´ = []
    íŒ¨í„´ = new RegExp(ì‚¬ì–‘.íŒ¨í„´)

    ë§¤ì¹­ = null
    while ((ë§¤ì¹­ = íŒ¨í„´.exec(ì¢…ëª©.ê²€ìƒ‰ê²°ê³¼í…ìŠ¤íŠ¸)) !== null):
      ì›ì‹œê°’ = ì‚¬ì–‘.ë³€í™˜(ë§¤ì¹­[1])

      // ë‚ ì§œ í•„í„°: ${targetDate.iso} ê°’ë§Œ í—ˆìš©, ë‚ ì§œ ë¶ˆëª…í™• ì‹œ íê¸°
      ë§Œì•½ ë§¤ì¹­.inputì— "${searchFormats.naverStyle}" ë˜ëŠ” "${targetDate.iso}" ë˜ëŠ” "${searchFormats.dotStyle}" í‘œê¸°ê°€ ì—†ìœ¼ë©´:
        ê³„ì†

      ë§Œì•½ ì‚¬ì–‘.ê²€ì¦(ì›ì‹œê°’):
        ë§¤ì¹­ë°°ì—´.push({
          ê°’: ì›ì‹œê°’,
          ì¶œì²˜: ë§¤ì¹­.input.substring(Math.max(0, ë§¤ì¹­.index - 50), ë§¤ì¹­.index + 50)
        })

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš« í™˜ê° íƒì§€ íŒ¨í„´ ë§¤ì¹­ (ê°•í™”)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê²€ì¦ ì‹œ ì•„ë˜ íŒ¨í„´ì´ ë°œê²¬ë˜ë©´ í™˜ê°ìœ¼ë¡œ ê°„ì£¼:

íŒ¨í„´ 1: ì˜ˆì‹œê°’ ë³µì‚¬ ì˜ì‹¬
  IF close_price IN [75300, 142500, 215000, 52400, 85000, 50000, 100000]:
    â†’ ì¬ê²€ìƒ‰ í•„ìˆ˜ (ì´ ê°’ë“¤ì€ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œê°’ ë˜ëŠ” ë„ˆë¬´ ê¹”ë”í•œ ê°’)
    â†’ ê²€ìƒ‰ ê²°ê³¼ì™€ ì •í™•íˆ ì¼ì¹˜ í™•ì¸ í•„ìš”

íŒ¨í„´ 2: ë¼ìš´ë“œ ë„˜ë²„ ì˜ì‹¬
  IF close_price % 1000 == 0 AND close_price > 10000:
    â†’ ì¬ê²€ìƒ‰ ê¶Œì¥ (ì‹¤ì œ ì¢…ê°€ëŠ” 10ì›/100ì› ë‹¨ìœ„)
    â†’ ì˜ˆ: 75000 ì˜ì‹¬, 75320 ì •ìƒ

íŒ¨í„´ 3: ì§€í‘œê°’ ì¼ê´€ì„± ì˜ì‹¬
  IF RSI == 50 OR RSI == 55 OR RSI == 60 OR RSI == 65 OR RSI == 70:
    â†’ ì¬ê²€ìƒ‰ ê¶Œì¥ (ë„ˆë¬´ "ê¹”ë”í•œ" ê°’)
    â†’ ì‹¤ì œ RSIëŠ” 58.37 ê°™ì€ ì†Œìˆ˜ì  í¬í•¨

íŒ¨í„´ 4: ëª¨ë“  ì§€í‘œê°€ ê¸ì •ì 
  IF ëª¨ë“ _ì§€í‘œ_ì ìˆ˜ >= 80:
    â†’ ê²½ê³ : í˜„ì‹¤ì ì´ì§€ ì•ŠìŒ
    â†’ ì¼ë¶€ ì§€í‘œëŠ” ì¤‘ë¦½/ë¶€ì •ì ì´ì–´ì•¼ ì •ìƒ

íŒ¨í„´ 5: ë‚ ì§œ ë¶ˆì¼ì¹˜
  IF ê²€ìƒ‰ê²°ê³¼_ë‚ ì§œ !== "${targetDate.iso}":
    â†’ í•´ë‹¹ ë°ì´í„° ì¦‰ì‹œ íê¸°
    â†’ ${forbiddenYearThreshold}ë…„ ì´ì „ ë°ì´í„° ì ˆëŒ€ ê¸ˆì§€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€close_price 2ì°¨ ê²€ì¦ ì˜ë¬´ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Stage 6ì—ì„œ ëª¨ë“  ì¢…ëª©ì˜ close_priceë¥¼ ë°˜ë“œì‹œ ì¬ê²€ì¦:

ì¬ê²€ì¦_ì¿¼ë¦¬:
  "[ì¢…ëª©ëª…] [ì¢…ëª©ì½”ë“œ] ì¢…ê°€ ${searchFormats.naverStyle} site:finance.naver.com"

ì¬ê²€ì¦_ì²´í¬:
  â–¡ Stage 2ì—ì„œ ê¸°ë¡í•œ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ê°€?
  â–¡ ê²€ìƒ‰ ê²°ê³¼ì˜ ë‚ ì§œê°€ ${targetDate.iso}ì™€ ì •í™•í•œê°€?
  â–¡ 3ê°œ ì´ìƒ ì†ŒìŠ¤ì—ì„œ ë™ì¼ ê°’ í™•ì¸í–ˆëŠ”ê°€?

ë¶ˆì¼ì¹˜ ì‹œ:
  â†’ ê²€ìƒ‰ ê²°ê³¼ ê°’ìœ¼ë¡œ êµì²´
  â†’ ìˆ˜ì •ë¡œê·¸ì— ê¸°ë¡: "close_price ìˆ˜ì •: [ì›ë³¸ê°’] â†’ [ê²€ìƒ‰ê°’] (ê²€ìƒ‰ê²°ê³¼)"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ìµœì¢… JSON í™˜ê° ì²´í¬ë¦¬ìŠ¤íŠ¸ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

JSON ì¶œë ¥ ì „ ë°˜ë“œì‹œ í™•ì¸:

â–¡ 1. close_priceê°€ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì§ì ‘ ì¶”ì¶œëœ ê°’ì¸ê°€?
â–¡ 2. rationaleì˜ ëª¨ë“  ìˆ˜ì¹˜ì— ì¶œì²˜ê°€ ìˆëŠ”ê°€?
â–¡ 3. ëª¨ë“  ë‚ ì§œê°€ ${targetDate.iso}ì™€ ì¼ì¹˜í•˜ëŠ”ê°€?
â–¡ 4. ì ìˆ˜ ë¶„í¬ê°€ í˜„ì‹¤ì ì¸ê°€? (ëª¨ë‘ 90ì  ì´ìƒì€ ì˜ì‹¬)
â–¡ 5. RSI/MACD ë“± ìˆ˜ì¹˜ê°€ ì†Œìˆ˜ì  í¬í•¨ ì‹¤ì¸¡ê°’ì¸ê°€?

1ê°œë¼ë„ ë¯¸ì¶©ì¡±:
  â†’ í•´ë‹¹ ì¢…ëª© ì¬ê²€ì¦
  â†’ ì¬ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì œì™¸

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Â§4. í†µí•© ì˜¤ë¥˜ ë³µêµ¬ ì‹œìŠ¤í…œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì•Œê³ ë¦¬ì¦˜ 4.2: ì „ì²´ ê²€ì¦ ì‹¤íŒ¨ ì²˜ë¦¬
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê° ì¢…ëª©ë³„_ì˜¤ë¥˜ìˆ˜ ê³„ì‚°
ì‹¤íŒ¨_ì¢…ëª©ìˆ˜ = ì¢…ëª©ë“¤.filter(ì¢…ëª© => ì¢…ëª©.ê²€ì¦ì‹¤íŒ¨ === true).length

ë§Œì•½ ì‹¤íŒ¨_ì¢…ëª©ìˆ˜ >= 1:
  // í˜„ì¬ ë°ì´í„° í™•ë³´ ì‹¤íŒ¨ê°€ 1ê°œë¼ë„ ìˆìœ¼ë©´ ì¦‰ì‹œ ì¤‘ë‹¨

  ë¡œê·¸.push({
    ë‹¨ê³„: "STAGE_6",
    ìƒíƒœ: "ì¬ì‹œë„_í•„ìš”",
    ì´ìœ : "í˜„ì¬_ë°ì´í„°_í™•ë³´_ì‹¤íŒ¨",
    ì‹¤íŒ¨ì¢…ëª©ìˆ˜: ì‹¤íŒ¨_ì¢…ëª©ìˆ˜,
    ì¡°ì¹˜: "STAGE_1ë¶€í„°_ë‹¤ë¥¸_ì¢…ëª©ìœ¼ë¡œ_ì¬ì‹œë„"
  })

  // ì¬ì‹œë„ ì‹ í˜¸ ë°˜í™˜
  return JSON.stringify({
    error: "STAGE_6_VERIFICATION_FAILED",
    retry: true,
    details: {
      failed_stocks: ì‹¤íŒ¨ì¢…ëª©_ëª©ë¡,
      target_date: "${targetDate.iso}",
      recommendation: "STAGE 1ë¶€í„° ë‹¤ë¥¸ ì¢…ëª©ìœ¼ë¡œ ì¬ì‹œë„ í•„ìš”"
    }
  })

ì•„ë‹ˆë©´:
  // ì •ìƒ ì²˜ë¦¬: ê²€ì¦ëœ ì¢…ëª© + ìˆ˜ì • ë¡œê·¸ ë°˜í™˜

  ìµœì¢…ì¶œë ¥ = ì¢…ëª©ë“¤.map(ì¢…ëª© => ({
    ticker: ì¢…ëª©.ticker,
    name: ì¢…ëª©.name,
    close_price: ì¢…ëª©.close_price,
    rationale: ì¢…ëª©.ìˆ˜ì •ëœrationale,
    signals: ì¢…ëª©.ì¡°ì •ëœsignals,
    verified_date: "${targetDate.iso}"
  }))

  return ìµœì¢…ì¶œë ¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Â§5. ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤ ë° ê²€ì¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

interface Stage6ì¶œë ¥ {
  ticker: string;           // /^KOSPI:\\d{6}$/
  name: string;             // í•œê¸€ íšŒì‚¬ëª…
  close_price: number;      // ì „ì¼ ì¢…ê°€ > 0
  rationale: string;        // ìˆ˜ì •ëœ ì§€í‘œ ë¬¸ìì—´ (ìµœì†Œ 10ê°œ)
  signals: {
    trend_score: number;      // 0-100 ì •ìˆ˜
    momentum_score: number;   // 0-100 ì •ìˆ˜
    volume_score: number;     // 0-100 ì •ìˆ˜
    volatility_score: number; // 0-100 ì •ìˆ˜
    pattern_score: number;    // 0-100 ì •ìˆ˜
    sentiment_score: number;  // 0-100 ì •ìˆ˜
    overall_score: number;    // 0-100 ì •ìˆ˜ (ê°€ì¤‘ í‰ê· )
  };
  verified_date: string;    // "${targetDate.iso}" í˜•ì‹
}

type Stage6ì¶œë ¥íƒ€ì… = Stage6ì¶œë ¥[];  // ì •í™•íˆ 3ê°œ ì¢…ëª©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Â§6. ì‹¤í–‰ ì§€ì‹œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì´ ì‚¬ì–‘ì„œì˜ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ STAGE 6 ì‹¤í–‰:

ì‹¤í–‰_ìˆœì„œ:
  1. Stage 5 JSON íŒŒì‹±
  2. ë°°ì¹˜ ê²€ì¦ ì‹¤í–‰
  3. ë°°ì¹˜ ê²€ìƒ‰ 3-6ê°œ ì‹¤í–‰ (ë‚ ì§œ í•„í„°: ${targetDate.iso})
  4. ì‹¤ì œ ê°’ ì •ë°€ ì¶”ì¶œ
  5. ì§€í‘œ ê²€ì¦ ë° ìˆ˜ì •
  6. ì ìˆ˜ ì¬ê³„ì‚°
  7. í†µí•© ì˜¤ë¥˜ ë³µêµ¬
  8. ì¶œë ¥ ê²€ì¦
  9. ìµœì¢… JSON ë°˜í™˜

í•µì‹¬_ê·œì¹™:
  - GoogleSearchRetrieval APIë§Œ ì‚¬ìš© (ë°°ì¹˜ ìµœì í™”)
  - ëª¨ë“  ê²€ìƒ‰ì— ${searchFormats.naverStyle} ë˜ëŠ” ${targetDate.iso} í¬í•¨
  - ê²€ì¦ ë¶ˆê°€ ì‹œ ì¦‰ì‹œ ì‚­ì œí•˜ê³  ì¬ê²€ì¦ì„ ìš”ì²­í•œë‹¤
  - ì¢…ëª©ë‹¹ ìµœì†Œ 10ê°œ rationale ì§€í‘œ í•„ìˆ˜
  - overall_score = ì •í™•í•œ ê°€ì¤‘í‰ê·  ê³µì‹
  - ê²€ì¦ ì‹¤íŒ¨ê°€ 1ê°œë¼ë„ ìˆìœ¼ë©´ ì¬ì‹œë„ ì‹ í˜¸ ë°˜í™˜
  - ëª¨ë“  ì˜¤ë¥˜ëŠ” ë³µêµ¬ ì‹œë„ í›„ ë¡œê·¸ ê¸°ë¡

STAGE 6 ì‹¤í–‰ ì‹œì‘.
ê¸°ì¤€ì¼: ${targetDate.korean} (${targetDate.iso})
`;
}
