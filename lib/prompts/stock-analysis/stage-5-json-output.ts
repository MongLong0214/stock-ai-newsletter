export const STAGE_5_JSON_OUTPUT = `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
STAGE 5: 최종 JSON 출력 및 3대 핵심 검증
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 목표: JSON 생성 + 3가지 핵심 사항 최종 검증

🚨🚨🚨 최우선 임무: JSON 출력 전 반드시 검증 🚨🚨🚨

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【STEP 1】 이전 STAGE 결과에서 3개 종목 데이터 확인
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

이전 STAGE 4 결과를 읽고 다음 정보 추출:

종목 1:
- ticker: (예: KOSPI:005930)
- name: (예: 삼성전자)
- close_price: (예: 75300)

종목 2:
- ticker: (예: KOSPI:000660)
- name: (예: SK하이닉스)
- close_price: (예: 142500)

종목 3:
- ticker: (예: KOSPI:035420)
- name: (예: NAVER)
- close_price: (예: 215000)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【STEP 2】 🔴 핵심 검증 #1: 종목 실존 여부 (MANDATORY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚨 각 종목이 실제로 존재하는 상장 종목인지 확인 (Google Search 활용)

종목 1 검증:
✅ "[종목명] [6자리코드] 한국거래소 상장 site:finance.naver.com"
✅ "[6자리코드] 종목 정보 site:data.krx.co.kr"

IF 검색 결과가 없거나 "상장폐지", "거래정지" 등장:
   ❌ 해당 종목은 사용 불가
   ❌ 즉시 JSON 생성 중단
   ❌ 에러 발생: "종목 실존 검증 실패: [종목명]"

종목 2 검증:
(위와 동일한 프로세스 반복)

종목 3 검증:
(위와 동일한 프로세스 반복)

✅ 3개 종목 모두 실존 확인 완료해야만 다음 단계 진행

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【STEP 3】 🔴 핵심 검증 #2: 전일종가 정확성 (MANDATORY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚨 각 종목의 전일종가를 최소 3개 소스에서 교차 검증 (Google Search 활용)

오늘 날짜: [현재 날짜 확인]
전일 날짜: [전일 날짜 계산]

종목 1 전일종가 검증:
소스1: "[종목명] [6자리코드] [전일날짜] 종가 site:finance.naver.com"
소스2: "[6자리코드] [전일날짜] 종가 site:data.krx.co.kr"
소스3: "[종목명] [전일날짜] 주가 site:finance.daum.net"

검증 결과:
- 소스1: ___원
- 소스2: ___원
- 소스3: ___원
- STAGE 4 데이터: ___원

IF 3개 소스 중 2개 이상이 STAGE 4 데이터와 정확히 일치:
   ✅ 검증 통과
ELSE IF 3개 소스 중 2개 이상이 STAGE 4 데이터와 ±2% 이내 차이:
   ⚠️ 검증 통과 (소스 간 시간차 허용)
   ⚠️ 가장 최신 소스의 값 사용
ELSE:
   ❌ 전일종가 불일치 감지 (차이 > 2%)
   ❌ 해당 종목을 STAGE 4의 다음 후보(4위~10위)로 교체
   ❌ 교체 후 새 종목에 대해 STEP 2~3 재검증

종목 2 전일종가 검증:
(위와 동일한 프로세스 반복)

종목 3 전일종가 검증:
(위와 동일한 프로세스 반복)

🚨🚨🚨 중요: 3개 종목 확보 실패 시 🚨🚨🚨

IF 최대 10회 교체 시도 후에도 3개 확보 실패:
   ❌ JSON 생성하지 말 것
   ❌ 즉시 에러 발생: "STAGE 5 실패: 3개 종목 확보 불가"
   ❌ 이 경우 전체 Pipeline이 STAGE 0부터 재시도됨
   ❌ 1~2개 종목만으로는 절대 JSON 출력 금지

⚠️ 빈 JSON [] 절대 금지
⚠️ 3개 미만 JSON 절대 금지

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【STEP 4】 🔴 핵심 검증 #3: JSON 형식 정확성 (MANDATORY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

JSON 생성 전 체크리스트:

✅ 정확히 3개 종목 (더 많거나 적으면 안 됨)
✅ 각 종목마다 필수 필드 5개 존재:
   - ticker (문자열)
   - name (문자열)
   - close_price (정수)
   - rationale (문자열, "|" 구분, 최소 12개 지표)
   - signals (객체, 7개 점수 모두 0-100 정수)

✅ 금지 필드 절대 포함 금지:
   - target_price ❌
   - entry_price ❌
   - stop_loss ❌
   - 투자 권유 표현 ❌

✅ JSON 문법:
   - '[' 로 시작
   - ']' 로 종료
   - 올바른 쉼표, 따옴표, 괄호
   - 유효한 JSON (파싱 가능)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【STEP 5】 최종 JSON 생성 및 출력
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ STEP 2 (종목 실존) 검증 완료
✅ STEP 3 (전일종가) 검증 완료
✅ STEP 4 (JSON 형식) 검증 완료

→ 이제 JSON 출력 가능

출력 형식:

[
  {
    "ticker": "KOSPI:005930",
    "name": "삼성전자",
    "close_price": 75300,
    "rationale": "SMA 완전정배열|EMA 골든크로스|RSI 58 강세권|MACD 양전환|거래량 165% 급증|볼린저 중상단|ATR 3.2% 적정|ADX 28 강한추세|OBV 지속상승|스토캐스틱 상승전환|SuperTrend 매수|52주 상위 72%",
    "signals": {
      "trend_score": 88,
      "momentum_score": 85,
      "volume_score": 90,
      "volatility_score": 82,
      "pattern_score": 87,
      "sentiment_score": 84,
      "overall_score": 86
    }
  },
  {
    "ticker": "KOSPI:000660",
    "name": "SK하이닉스",
    "close_price": 142500,
    "rationale": "...",
    "signals": { ... }
  },
  {
    "ticker": "KOSPI:035420",
    "name": "NAVER",
    "close_price": 215000,
    "rationale": "...",
    "signals": { ... }
  }
]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔥 실행 명령

1. STEP 2 실행: 3개 종목 실존 여부 Google Search로 확인
2. STEP 3 실행: 3개 종목 전일종가를 3개 소스에서 교차 검증
3. STEP 4 실행: JSON 형식 체크리스트 확인
4. 모든 검증 통과 시에만 STEP 5 실행: 순수 JSON 출력

⚠️ 검증 실패 시:
- JSON 생성하지 말 것
- 에러 메시지 출력: "검증 실패: [구체적 이유]"

⚠️ 검증 성공 시:
- '[' 로 시작하는 순수 JSON만 출력
- 다른 텍스트 일절 없음
- 완벽한 3개 종목 데이터

지금 즉시 STEP 2부터 순차 실행 시작!`;
